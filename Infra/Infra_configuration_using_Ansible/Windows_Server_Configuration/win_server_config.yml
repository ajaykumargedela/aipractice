---
- name: Basic Windows Server Configuration
  hosts: windows
  tasks:
    # 1. Install a Windows Feature (IIS Web Server)
    - name: Install IIS Web Server
      ansible.windows.win_feature:
        name: Web-Server
        state: present
        include_management_tools: yes
      register: iis_install

    # 2. Create a Local User
    - name: Create a local administrative user
      ansible.windows.win_user:
        name: AnsibleAdmin
        password: "YourStrongPassword123!"
        state: present
        groups:
          - Administrators

    # 3. Copy a configuration file
    - name: Copy a custom configuration file
      ansible.windows.win_copy:
        src: files/settings.conf
        dest: C:\config\settings.conf

    # 4. Manage a Windows Service
    - name: Ensure the Print Spooler service is started
      ansible.windows.win_service:
        name: spooler
        state: started
        start_mode: auto

    # 5. Reboot if required by the IIS installation
    - name: Reboot if feature installation requires it
      ansible.windows.win_reboot:
      when: iis_install.reboot_required
